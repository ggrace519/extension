var rt=Object.defineProperty;var st=(t,o,e)=>o in t?rt(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var Ae=(t,o,e)=>st(t,typeof o!="symbol"?o+"":o,e);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();function ne(){}function Ve(t){return t()}function Re(){return Object.create(null)}function le(t){t.forEach(Ve)}function Ye(t){return typeof t=="function"}function Je(t,o){return t!=t?o==o:t!==o||t&&typeof t=="object"||typeof t=="function"}function it(t){return Object.keys(t).length===0}function d(t,o){t.appendChild(o)}function K(t,o,e){t.insertBefore(o,e||null)}function N(t){t.parentNode&&t.parentNode.removeChild(t)}function Qe(t,o){for(let e=0;e<t.length;e+=1)t[e]&&t[e].d(o)}function y(t){return document.createElement(t)}function xe(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function W(t){return document.createTextNode(t)}function T(){return W(" ")}function Xe(){return W("")}function H(t,o,e,l){return t.addEventListener(o,e,l),()=>t.removeEventListener(o,e,l)}function ct(t){return function(o){return o.preventDefault(),t.call(this,o)}}function i(t,o,e){e==null?t.removeAttribute(o):t.getAttribute(o)!==e&&t.setAttribute(o,e)}function dt(t){return Array.from(t.childNodes)}function we(t,o){o=""+o,t.data!==o&&(t.data=o)}function F(t,o){t.value=o??""}function Ue(t,o,e){for(let l=0;l<t.options.length;l+=1){const n=t.options[l];if(n.__value===o){n.selected=!0;return}}(!e||o!==void 0)&&(t.selectedIndex=-1)}function ut(t){const o=t.querySelector(":checked");return o&&o.__value}let fe;function ae(t){fe=t}function at(){if(!fe)throw new Error("Function called outside component initialization");return fe}function ft(t){at().$$.on_mount.push(t)}const ie=[],Oe=[];let ce=[];const je=[],wt=Promise.resolve();let He=!1;function pt(){He||(He=!0,wt.then(Ge))}function ke(t){ce.push(t)}const Te=new Set;let se=0;function Ge(){if(se!==0)return;const t=fe;do{try{for(;se<ie.length;){const o=ie[se];se++,ae(o),mt(o.$$)}}catch(o){throw ie.length=0,se=0,o}for(ae(null),ie.length=0,se=0;Oe.length;)Oe.pop()();for(let o=0;o<ce.length;o+=1){const e=ce[o];Te.has(e)||(Te.add(e),e())}ce.length=0}while(ie.length);for(;je.length;)je.pop()();He=!1,Te.clear(),ae(t)}function mt(t){if(t.fragment!==null){t.update(),le(t.before_update);const o=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,o),t.after_update.forEach(ke)}}function gt(t){const o=[],e=[];ce.forEach(l=>t.indexOf(l)===-1?o.push(l):e.push(l)),e.forEach(l=>l()),ce=o}const _e=new Set;let ht;function $e(t,o){t&&t.i&&(_e.delete(t),t.i(o))}function yt(t,o,e,l){if(t&&t.o){if(_e.has(t))return;_e.add(t),ht.c.push(()=>{_e.delete(t)}),t.o(o)}}function Ee(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function bt(t){t&&t.c()}function et(t,o,e){const{fragment:l,after_update:n}=t.$$;l&&l.m(o,e),ke(()=>{const r=t.$$.on_mount.map(Ve).filter(Ye);t.$$.on_destroy?t.$$.on_destroy.push(...r):le(r),t.$$.on_mount=[]}),n.forEach(ke)}function tt(t,o){const e=t.$$;e.fragment!==null&&(gt(e.after_update),le(e.on_destroy),e.fragment&&e.fragment.d(o),e.on_destroy=e.fragment=null,e.ctx=[])}function _t(t,o){t.$$.dirty[0]===-1&&(ie.push(t),pt(),t.$$.dirty.fill(0)),t.$$.dirty[o/31|0]|=1<<o%31}function ot(t,o,e,l,n,r,s=null,u=[-1]){const w=fe;ae(t);const c=t.$$={fragment:null,ctx:[],props:r,update:ne,not_equal:n,bound:Re(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(w?w.$$.context:[])),callbacks:Re(),dirty:u,skip_bound:!1,root:o.target||w.$$.root};s&&s(c.root);let g=!1;if(c.ctx=e?e(t,o.props||{},(b,p,...k)=>{const m=k.length?k[0]:p;return c.ctx&&n(c.ctx[b],c.ctx[b]=m)&&(!c.skip_bound&&c.bound[b]&&c.bound[b](m),g&&_t(t,b)),p}):[],c.update(),g=!0,le(c.before_update),c.fragment=l?l(c.ctx):!1,o.target){if(o.hydrate){const b=dt(o.target);c.fragment&&c.fragment.l(b),b.forEach(N)}else c.fragment&&c.fragment.c();o.intro&&$e(t.$$.fragment),et(t,o.target,o.anchor),Ge()}ae(w)}class nt{constructor(){Ae(this,"$$");Ae(this,"$$set")}$destroy(){tt(this,1),this.$destroy=ne}$on(o,e){if(!Ye(e))return ne;const l=this.$$.callbacks[o]||(this.$$.callbacks[o]=[]);return l.push(e),()=>{const n=l.indexOf(e);n!==-1&&l.splice(n,1)}}$set(o){this.$$set&&!it(o)&&(this.$$.skip_bound=!0,this.$$set(o),this.$$.skip_bound=!1)}}const xt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(xt);const Ne=async(t,o)=>new Promise((e,l)=>{chrome.runtime.sendMessage({action:"fetchModels",url:o,key:t},n=>{var s;if(chrome.runtime.lastError){l(new Error(chrome.runtime.lastError.message));return}if(n.error){l(n.error);return}let r=((s=n.data)==null?void 0:s.data)??[];r=r.filter(u=>u).sort((u,w)=>{const c=u.name.toLowerCase(),g=w.name.toLowerCase();return c<g?-1:c>g?1:u<w?-1:u>w?1:0}),console.log(r),e(r)})}),Se=async(t="",o={},e="http://localhost:8080")=>new Promise((l,n)=>{const r=chrome.runtime.connect({name:"chat-stream"});let s=null,u=!1;const w=new ReadableStream({start(g){s=g}});r.onMessage.addListener(g=>{if(g.error){s&&s.error(new Error(g.error)),r.disconnect(),n(new Error(g.error));return}if(g.done){u=!0,s&&s.close(),r.disconnect();return}g.chunk&&s&&s.enqueue(new TextEncoder().encode(g.chunk))}),r.onDisconnect.addListener(()=>{!u&&s&&s.error(new Error("Stream disconnected unexpectedly"))});const c={ok:!0,status:200,body:w};r.postMessage({action:"fetchChatCompletion",url:e,api_key:t,body:o}),l([c,{abort:()=>{r.disconnect()}}])}),Pe=t=>{let o="";return new TransformStream({transform(e,l){o+=e;const n=o.split(t);n.slice(0,-1).forEach(r=>l.enqueue(r)),o=n[n.length-1]},flush(e){o&&e.enqueue(o)}})};function ze(t,o,e){const l=t.slice();return l[35]=o[e],l[37]=e,l}function Ke(t,o,e){const l=t.slice();return l[15]=o[e],l}function Be(t){let o,e,l;function n(u,w){return u[1]?Et:kt}let r=n(t),s=r(t);return{c(){o=y("div"),s.c(),i(o,"class","tlwd-fixed tlwd-top-0 tlwd-right-0 tlwd-left-0 tlwd-bottom-0 tlwd-w-full tlwd-min-h-screen tlwd-h-screen tlwd-flex tlwd-justify-center tlwd-z-[9999999999] tlwd-overflow-hidden tlwd-overscroll-contain")},m(u,w){K(u,o,w),s.m(o,null),e||(l=H(o,"mousedown",t[26]),e=!0)},p(u,w){r===(r=n(u))&&s?s.p(u,w):(s.d(1),s=r(u),s&&(s.c(),s.m(o,null)))},d(u){u&&N(o),s.d(),e=!1,l()}}}function kt(t){let o,e,l,n,r,s,u,w,c,g,b,p,k,m;return{c(){o=y("div"),e=y("div"),l=y("form"),n=y("div"),r=y("div"),r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path></svg>`,s=T(),u=y("input"),w=T(),c=y("div"),g=y("div"),g.textContent="Press âŒ˜Space+Shift to toggle",b=T(),p=y("button"),p.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-3"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path></svg>`,i(r,"class","tlwd-flex tlwd-items-center"),i(u,"id","open-webui-search-input"),i(u,"placeholder","Search Open WebUI"),i(u,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),i(u,"autocomplete","one-time-code"),i(n,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full"),i(g,"class","tlwd-text-right tlwd-text-[0.7rem] tlwd-p-0 tlwd-m-0 tlwd-text-neutral-300 tlwd-h-fit"),i(p,"class","tlwd-h-fit tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),i(p,"type","button"),i(c,"class","tlwd-flex tlwd-justify-end tlwd-gap-1 tlwd-items-center"),i(l,"class","tlwd-text-gray-200 tlwd-w-full tlwd-p-0 tlwd-m-0"),i(l,"autocomplete","off"),i(e,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-2.5 tlwd-px-3.5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation"),i(o,"class","tlwd-m-auto tlwd-max-w-xl tlwd-w-full tlwd-pb-32")},m(v,R){K(v,o,R),d(o,e),d(e,l),d(l,n),d(n,r),d(n,s),d(n,u),F(u,t[12]),d(l,w),d(l,c),d(c,g),d(c,b),d(c,p),k||(m=[H(u,"input",t[24]),H(p,"click",t[25]),H(l,"submit",t[16]),H(l,"mousedown",Tt)],k=!0)},p(v,R){R[0]&4096&&u.value!==v[12]&&F(u,v[12])},d(v){v&&N(o),k=!1,le(m)}}}function Et(t){let o,e,l,n,r,s,u,w,c,g,b,p,k,m,v,R,S,C=t[13]&&t[13].length>0&&De(t);return{c(){o=y("div"),e=y("div"),l=y("form"),n=y("div"),r=y("div"),r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"></path></svg>`,s=T(),u=y("input"),w=T(),c=y("div"),g=y("div"),g.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"></path></svg>`,b=T(),p=y("input"),k=T(),m=y("button"),m.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"></path></svg>`,v=T(),C&&C.c(),i(r,"class","tlwd-flex tlwd-items-center"),i(u,"id","open-webui-url-input"),i(u,"placeholder","Open WebUI URL"),i(u,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),i(u,"autocomplete","one-time-code"),u.required=!0,i(n,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full"),i(g,"class","tlwd-flex tlwd-items-center"),i(p,"placeholder","Open WebUI API Key"),i(p,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),i(p,"autocomplete","one-time-code"),p.required=!0,i(m,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),i(m,"type","button"),i(c,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mt-2"),i(l,"class","tlwd-text-gray-200 tlwd-w-full tlwd-p-0 tlwd-m-0"),i(l,"autocomplete","off"),i(e,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-2.5 tlwd-px-3.5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation"),i(o,"class","tlwd-m-auto tlwd-max-w-sm tlwd-w-full tlwd-pb-32")},m(P,q){K(P,o,q),d(o,e),d(e,l),d(l,n),d(n,r),d(n,s),d(n,u),F(u,t[10]),d(l,w),d(l,c),d(c,g),d(c,b),d(c,p),F(p,t[11]),d(c,k),d(c,m),d(l,v),C&&C.m(l,null),R||(S=[H(u,"input",t[20]),H(p,"input",t[21]),H(m,"click",t[22]),H(l,"submit",t[17]),H(l,"mousedown",At)],R=!0)},p(P,q){q[0]&1024&&u.value!==P[10]&&F(u,P[10]),q[0]&2048&&p.value!==P[11]&&F(p,P[11]),P[13]&&P[13].length>0?C?C.p(P,q):(C=De(P),C.c(),C.m(l,null)):C&&(C.d(1),C=null)},d(P){P&&N(o),C&&C.d(),R=!1,le(S)}}}function De(t){let o,e,l,n,r,s,u,w,c,g=Ee(t[13]),b=[];for(let p=0;p<g.length;p+=1)b[p]=Fe(Ke(t,g,p));return{c(){o=y("div"),e=y("div"),e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"></path></svg>`,l=T(),n=y("select"),r=y("option"),r.textContent="Select a model";for(let p=0;p<b.length;p+=1)b[p].c();s=T(),u=y("button"),u.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path></svg>`,i(e,"class","tlwd-flex tlwd-items-center"),r.__value="",F(r,r.__value),i(n,"id","open-webui-model-input"),i(n,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),i(n,"autocomplete","off"),n.required=!0,t[15]===void 0&&ke(()=>t[23].call(n)),i(u,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),i(u,"type","submit"),i(o,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mt-2")},m(p,k){K(p,o,k),d(o,e),d(o,l),d(o,n),d(n,r);for(let m=0;m<b.length;m+=1)b[m]&&b[m].m(n,null);Ue(n,t[15],!0),d(o,s),d(o,u),w||(c=H(n,"change",t[23]),w=!0)},p(p,k){if(k[0]&8192){g=Ee(p[13]);let m;for(m=0;m<g.length;m+=1){const v=Ke(p,g,m);b[m]?b[m].p(v,k):(b[m]=Fe(v),b[m].c(),b[m].m(n,null))}for(;m<b.length;m+=1)b[m].d(1);b.length=g.length}k[0]&40960&&Ue(n,p[15])},d(p){p&&N(o),Qe(b,p),w=!1,c()}}}function Fe(t){let o,e=(t[15].name??t[15].id)+"",l,n;return{c(){o=y("option"),l=W(e),o.__value=n=t[15].id,F(o,o.__value)},m(r,s){K(r,o,s),d(o,l)},p(r,s){s[0]&8192&&e!==(e=(r[15].name??r[15].id)+"")&&we(l,e),s[0]&8192&&n!==(n=r[15].id)&&(o.__value=n,F(o,o.__value))},d(r){r&&N(o)}}}function qe(t){let o,e,l,n,r,s,u,w,c,g,b,p,k,m,v,R,S,C,P,q,Z,V,de,Y,B,D,$,pe,re,me,J,ue,ge,Q=Ee(t[6]),U=[];for(let h=0;h<Q.length;h+=1)U[h]=We(ze(t,Q,h));function Ie(h,E){if(h[3]&&h[7])return Ct;if(h[7]&&!h[3])return Mt}let ee=Ie(t),_=ee&&ee(t),x=t[9]&&t[8]&&Ze(t);return{c(){o=y("div"),e=y("div"),l=y("div"),n=y("div"),r=y("div"),r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5 tlwd-text-neutral-300"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"></path></svg> <h3 class="tlwd-text-lg tlwd-font-semibold tlwd-text-neutral-100">AI Response</h3>`,s=T(),u=y("button"),u.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>`,w=T(),c=y("div");for(let h=0;h<U.length;h+=1)U[h].c();g=T(),_&&_.c(),b=T(),x&&x.c(),p=T(),k=y("div"),m=y("form"),v=y("input"),R=T(),S=y("button"),C=W("Send"),q=T(),Z=y("div"),V=y("div"),V.textContent="Press Escape to close",de=T(),Y=y("div"),B=y("button"),D=xe("svg"),$=xe("path"),pe=W(`
                Continue in OpenWebUI`),me=T(),J=y("button"),J.textContent="Copy conversation",i(r,"class","tlwd-flex tlwd-items-center tlwd-gap-2"),i(u,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-400 hover:tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-1 tlwd-outline-none tlwd-border-none tlwd-transition-colors"),i(u,"type","button"),i(n,"class","tlwd-flex tlwd-items-center tlwd-justify-between tlwd-mb-4 tlwd-pb-3 tlwd-border-b tlwd-border-gray-700"),i(c,"class","tlwd-flex-1 tlwd-overflow-y-auto tlwd-pr-2 tlwd-mb-4"),i(v,"id","open-webui-followup-input"),i(v,"type","text"),i(v,"placeholder","Ask a follow-up question..."),v.disabled=t[7],i(v,"class","tlwd-flex-1 tlwd-px-3 tlwd-py-2 tlwd-text-sm tlwd-bg-gray-800/50 tlwd-border tlwd-border-gray-700 tlwd-rounded-lg tlwd-text-neutral-100 placeholder:tlwd-text-neutral-500 tlwd-outline-none focus:tlwd-border-gray-600 disabled:tlwd-opacity-50 disabled:tlwd-cursor-not-allowed"),i(v,"autocomplete","off"),i(S,"type","submit"),S.disabled=P=!t[5].trim()||t[7],i(S,"class","tlwd-px-4 tlwd-py-2 tlwd-text-sm tlwd-font-medium tlwd-bg-blue-600 hover:tlwd-bg-blue-700 disabled:tlwd-opacity-50 disabled:tlwd-cursor-not-allowed tlwd-text-white tlwd-rounded-lg tlwd-transition-colors tlwd-outline-none tlwd-border-none"),i(m,"class","tlwd-flex tlwd-items-center tlwd-gap-2"),i(V,"class","tlwd-text-xs tlwd-text-neutral-400"),i($,"stroke-linecap","round"),i($,"stroke-linejoin","round"),i($,"d","M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"),i(D,"xmlns","http://www.w3.org/2000/svg"),i(D,"fill","none"),i(D,"viewBox","0 0 24 24"),i(D,"stroke-width",2),i(D,"stroke","currentColor"),i(D,"class","tlwd-size-4"),i(B,"class","tlwd-text-xs tlwd-text-blue-400 hover:tlwd-text-blue-300 tlwd-cursor-pointer tlwd-outline-none tlwd-border-none tlwd-bg-transparent tlwd-transition-colors tlwd-flex tlwd-items-center tlwd-gap-1"),i(B,"type","button"),B.disabled=re=t[6].length===0,i(J,"class","tlwd-text-xs tlwd-text-neutral-300 hover:tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-outline-none tlwd-border-none tlwd-bg-transparent tlwd-transition-colors"),i(J,"type","button"),i(Y,"class","tlwd-flex tlwd-items-center tlwd-gap-3"),i(Z,"class","tlwd-mt-3 tlwd-flex tlwd-items-center tlwd-justify-between"),i(k,"class","tlwd-border-t tlwd-border-gray-700 tlwd-pt-3"),i(l,"role","dialog"),i(l,"aria-modal","true"),i(l,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-4 tlwd-px-5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation tlwd-max-h-[80vh] tlwd-overflow-hidden tlwd-flex tlwd-flex-col"),i(e,"class","tlwd-m-auto tlwd-max-w-3xl tlwd-w-full tlwd-pb-32 tlwd-px-4"),i(o,"role","dialog"),i(o,"aria-modal","true"),i(o,"class","tlwd-fixed tlwd-top-0 tlwd-right-0 tlwd-left-0 tlwd-bottom-0 tlwd-w-full tlwd-min-h-screen tlwd-h-screen tlwd-flex tlwd-justify-center tlwd-z-[9999999999] tlwd-overflow-hidden tlwd-overscroll-contain")},m(h,E){K(h,o,E),d(o,e),d(e,l),d(l,n),d(n,r),d(n,s),d(n,u),d(l,w),d(l,c);for(let a=0;a<U.length;a+=1)U[a]&&U[a].m(c,null);d(c,g),_&&_.m(c,null),t[28](c),d(l,b),x&&x.m(l,null),d(l,p),d(l,k),d(k,m),d(m,v),F(v,t[5]),d(m,R),d(m,S),d(S,C),d(k,q),d(k,Z),d(Z,V),d(Z,de),d(Z,Y),d(Y,B),d(B,D),d(D,$),d(B,pe),d(Y,me),d(Y,J),ue||(ge=[H(u,"click",t[27]),H(v,"input",t[29]),H(m,"submit",ct(t[19])),H(B,"click",t[18]),H(J,"click",t[30]),H(l,"mousedown",St),H(o,"mousedown",t[31])],ue=!0)},p(h,E){if(E[0]&64){Q=Ee(h[6]);let a;for(a=0;a<Q.length;a+=1){const j=ze(h,Q,a);U[a]?U[a].p(j,E):(U[a]=We(j),U[a].c(),U[a].m(c,g))}for(;a<U.length;a+=1)U[a].d(1);U.length=Q.length}ee===(ee=Ie(h))&&_?_.p(h,E):(_&&_.d(1),_=ee&&ee(h),_&&(_.c(),_.m(c,null))),h[9]&&h[8]?x?x.p(h,E):(x=Ze(h),x.c(),x.m(l,p)):x&&(x.d(1),x=null),E[0]&128&&(v.disabled=h[7]),E[0]&32&&v.value!==h[5]&&F(v,h[5]),E[0]&160&&P!==(P=!h[5].trim()||h[7])&&(S.disabled=P),E[0]&64&&re!==(re=h[6].length===0)&&(B.disabled=re)},d(h){h&&N(o),Qe(U,h),_&&_.d(),t[28](null),x&&x.d(),ue=!1,le(ge)}}}function vt(t){let o,e,l,n,r=t[35].content+"",s,u;return{c(){o=y("div"),e=y("div"),e.textContent="Assistant:",l=T(),n=y("div"),s=W(r),u=T(),i(e,"class","tlwd-text-xs tlwd-text-neutral-400 tlwd-mb-1"),i(n,"class","tlwd-text-sm tlwd-text-neutral-100 tlwd-whitespace-pre-wrap tlwd-leading-relaxed"),i(o,"class","tlwd-mb-4")},m(w,c){K(w,o,c),d(o,e),d(o,l),d(o,n),d(n,s),d(o,u)},p(w,c){c[0]&64&&r!==(r=w[35].content+"")&&we(s,r)},d(w){w&&N(o)}}}function It(t){let o,e,l,n,r=t[35].content+"",s,u;return{c(){o=y("div"),e=y("div"),e.textContent="You:",l=T(),n=y("div"),s=W(r),u=T(),i(e,"class","tlwd-text-xs tlwd-text-neutral-400 tlwd-mb-1"),i(n,"class","tlwd-text-sm tlwd-text-neutral-200 tlwd-bg-gray-800/50 tlwd-rounded-lg tlwd-p-3"),i(o,"class","tlwd-mb-4")},m(w,c){K(w,o,c),d(o,e),d(o,l),d(o,n),d(n,s),d(o,u)},p(w,c){c[0]&64&&r!==(r=w[35].content+"")&&we(s,r)},d(w){w&&N(o)}}}function We(t){let o;function e(r,s){if(r[35].role==="user")return It;if(r[35].role==="assistant")return vt}let l=e(t),n=l&&l(t);return{c(){n&&n.c(),o=Xe()},m(r,s){n&&n.m(r,s),K(r,o,s)},p(r,s){l===(l=e(r))&&n?n.p(r,s):(n&&n.d(1),n=l&&l(r),n&&(n.c(),n.m(o.parentNode,o)))},d(r){r&&N(o),n&&n.d(r)}}}function Mt(t){let o;return{c(){o=y("div"),o.innerHTML='<div class="tlwd-text-xs tlwd-text-neutral-400 tlwd-mb-1">Assistant:</div> <span class="tlwd-text-neutral-400 tlwd-italic">Waiting for response...</span>',i(o,"class","tlwd-mb-4")},m(e,l){K(e,o,l)},p:ne,d(e){e&&N(o)}}}function Ct(t){let o,e,l,n,r,s,u;return{c(){o=y("div"),e=y("div"),e.textContent="Assistant:",l=T(),n=y("div"),r=W(t[3]),s=T(),u=y("span"),u.textContent="|",i(e,"class","tlwd-text-xs tlwd-text-neutral-400 tlwd-mb-1"),i(u,"class","tlwd-inline-block tlwd-w-2 tlwd-h-4 tlwd-bg-neutral-400 tlwd-ml-1 tlwd-animate-pulse"),i(n,"class","tlwd-text-sm tlwd-text-neutral-100 tlwd-whitespace-pre-wrap tlwd-leading-relaxed"),i(o,"class","tlwd-mb-4")},m(w,c){K(w,o,c),d(o,e),d(o,l),d(o,n),d(n,r),d(n,s),d(n,u)},p(w,c){c[0]&8&&we(r,w[3])},d(w){w&&N(o)}}}function Ze(t){let o,e,l,n,r,s,u;return{c(){o=y("div"),e=y("div"),l=xe("svg"),n=xe("path"),r=T(),s=y("p"),u=W(t[8]),i(n,"stroke-linecap","round"),i(n,"stroke-linejoin","round"),i(n,"d","M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"),i(l,"xmlns","http://www.w3.org/2000/svg"),i(l,"fill","none"),i(l,"viewBox","0 0 24 24"),i(l,"stroke-width",2.5),i(l,"stroke","currentColor"),i(l,"class","tlwd-size-5 tlwd-text-red-400"),i(s,"class","tlwd-text-sm tlwd-text-red-300"),i(e,"class","tlwd-flex tlwd-items-center tlwd-gap-2"),i(o,"class","tlwd-mb-3 tlwd-p-3 tlwd-bg-red-900/20 tlwd-border tlwd-border-red-700/50 tlwd-rounded-lg")},m(w,c){K(w,o,c),d(o,e),d(e,l),d(l,n),d(e,r),d(e,s),d(s,u)},p(w,c){c[0]&256&&we(u,w[8])},d(w){w&&N(o)}}}function Lt(t){let o,e,l=t[0]&&Be(t),n=t[2]&&qe(t);return{c(){l&&l.c(),o=T(),n&&n.c(),e=Xe()},m(r,s){l&&l.m(r,s),K(r,o,s),n&&n.m(r,s),K(r,e,s)},p(r,s){r[0]?l?l.p(r,s):(l=Be(r),l.c(),l.m(o.parentNode,o)):l&&(l.d(1),l=null),r[2]?n?n.p(r,s):(n=qe(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ne,o:ne,d(r){r&&(N(o),N(e)),l&&l.d(r),n&&n.d(r)}}}const At=t=>{t.stopPropagation()},Tt=t=>{t.stopPropagation()},St=t=>{t.stopPropagation()};function Pt(t,o,e){let l=!1,n=!0,r=!1,s="",u="",w="",c=[],g=!1,b="",p=!1,k="",m="",v="",R="",S=[],C=null;const P=()=>{console.log("resetConfig");try{chrome.storage.local.clear().then(()=>{console.log("Value is cleared")})}catch(_){console.log(_)}e(10,k=""),e(11,m=""),e(15,v=""),e(13,S=[]),e(1,n=!0)},q=_=>{_.preventDefault();try{const x=new URL(k.startsWith("http")?k:`https://${k}`);if(!["http:","https:"].includes(x.protocol)){console.error("Extension: Invalid URL protocol");return}const h=encodeURIComponent(R),E=encodeURIComponent(v);window.open(`${k}/?q=${h}&models=${E}`,"_blank"),e(12,R=""),e(0,l=!1)}catch{console.error("Extension: Invalid URL format")}},Z=async _=>{_.preventDefault();try{const x=new URL(k.startsWith("http")?k:`https://${k}`);if(!["http:","https:"].includes(x.protocol)){console.error("Extension: Invalid URL protocol");return}}catch{console.error("Extension: Invalid URL format");return}if(!m||typeof m!="string"||m.trim().length===0){console.error("Extension: Invalid API key");return}if(!v||typeof v!="string"||v.trim().length===0){console.error("Extension: Invalid model");return}try{const x=await chrome.runtime.sendMessage({action:"encryptApiKey",apiKey:m.trim()});x.error?(console.error("Extension: Failed to encrypt API key:",x.error),chrome.storage.local.set({url:k.trim(),key:m.trim(),model:v.trim()})):chrome.storage.local.set({url:k.trim(),key:x.encrypted,model:v.trim()}).then(()=>{console.log("Value is set (API key encrypted)")})}catch(x){console.log(x)}e(1,n=!1)},V=async()=>{try{const _=await chrome.runtime.sendMessage({action:"getSelection"});((_==null?void 0:_.data)??!1)&&e(12,R=_.data)}catch(_){console.log("catch",_)}e(0,l=!l),setTimeout(()=>{const _=document.getElementById("open-webui-search-input");_&&_.focus()},0)},de=async _=>{var I;if(!_||_.trim().length===0){console.warn("Extension: No content to summarize"),e(8,b="No content could be extracted from this page."),e(9,p=!0),e(2,r=!0),setTimeout(()=>{e(9,p=!1),e(8,b="")},5e3);return}let x=k,h=m,E=v;try{const f=await chrome.storage.local.get(["url","key","model"]);if(f.url&&(x=f.url),f.model&&(E=f.model),f.key)try{const A=await chrome.runtime.sendMessage({action:"decryptApiKey",encryptedApiKey:f.key});A.error?(console.error("Extension: Failed to decrypt API key:",A.error),h=f.key):h=A.decrypted}catch(A){console.error("Extension: Error decrypting API key:",A),h=f.key}}catch(f){console.error("Extension: Error getting config:",f)}if(!x||!h||!E){console.warn("Extension: Missing configuration. Please configure the extension first."),e(1,n=!0);return}e(4,u="Summarize this page"),e(3,s=""),e(6,c=[{role:"system",content:"You are a helpful assistant that summarizes web page content. Ignore navigation menus, advertisements, cookie notices, footers, headers, and other non-content elements. Focus on the main article or content of the page. Provide a clear, concise summary."},{role:"user",content:_.substring(0,5e4)}]),e(2,r=!0),e(7,g=!0),e(9,p=!1),e(8,b="");const j=(S.length>0?((I=S.find(f=>f.id===E))==null?void 0:I.owned_by)==="openai":!1)?`${x}/openai`:`${x}/ollama/v1`;try{const[f,A]=await Se(h,{model:E,messages:c,stream:!0},j);if(f&&f.ok){const M=f.body.pipeThrough(new TextDecoderStream).pipeThrough(Pe(`
`)).getReader();for(;;){const{value:L,done:O}=await M.read();if(O)break;try{let z=L.split(`
`);for(const X of z)if(X!==""&&X!=="data: [DONE]"){let te=JSON.parse(X.replace(/^data: /,""));if(!("request_id"in te)){const G=te.choices[0].delta.content??"";e(3,s+=G),C&&setTimeout(()=>{e(14,C.scrollTop=C.scrollHeight,C)},0)}}}catch(z){console.log(z)}}try{s&&(c.some(O=>O.role==="assistant"&&O.content===s)||e(6,c=[...c,{role:"assistant",content:s}])),e(7,g=!1),e(3,s=""),setTimeout(()=>{const L=document.getElementById("open-webui-followup-input");L&&L.focus()},100)}catch(L){console.error("Extension: Error adding response to history:",L),e(7,g=!1)}}else console.error("Extension: API request failed:",f),e(2,r=!1),e(7,g=!1),e(8,b="Failed to get summary. Please check your configuration."),e(9,p=!0),setTimeout(()=>{e(9,p=!1),e(8,b="")},5e3)}catch(f){console.error("Extension: Error summarizing page:",f);const A=(f==null?void 0:f.message)||String(f);A.includes("Rate limit exceeded")?(e(8,b=A),e(9,p=!0),e(2,r=!0),setTimeout(()=>{e(9,p=!1),e(8,b="")},5e3)):(e(8,b=`Error: ${A}`),e(9,p=!0),e(2,r=!0),setTimeout(()=>{e(9,p=!1),e(8,b="")},5e3)),e(7,g=!1)}},Y=async()=>{var _,x;if(!k||c.length===0){console.warn("Extension: No conversation to continue or URL not configured");return}try{let h=k,E=m;try{const I=await chrome.storage.local.get(["url","key"]);if(I.url&&(h=I.url),I.key)try{const f=await chrome.runtime.sendMessage({action:"decryptApiKey",encryptedApiKey:I.key});f.error?E=I.key:E=f.decrypted}catch{E=I.key}}catch(I){console.error("Extension: Error getting config:",I)}const a=c.filter(I=>I.role!=="system");if(a.length===0){console.warn("Extension: No messages to send");return}try{const I=await chrome.runtime.sendMessage({action:"createChat",url:h,api_key:E,body:{title:((x=(_=a[0])==null?void 0:_.content)==null?void 0:x.substring(0,50))||"Extension Conversation",messages:a}});if(I.data&&I.data.id){window.open(`${h}/chat/${I.data.id}`,"_blank");return}else I.error&&console.log("Extension: Could not create chat via API, trying URL parameters:",I.error)}catch(I){console.log("Extension: Could not create chat via API, trying URL parameters:",I)}const j=a.find(I=>I.role==="user");if(j){const I=encodeURIComponent(j.content);window.open(`${h}/?q=${I}`,"_blank")}else window.open(h,"_blank")}catch(h){console.error("Extension: Error continuing in OpenWebUI:",h);try{const E=await chrome.storage.local.get(["url"]);E.url&&window.open(E.url,"_blank")}catch(E){console.error("Extension: Could not open OpenWebUI:",E)}}},B=async()=>{var I;if(!w.trim()||g)return;const _=w.trim();e(5,w=""),s&&(c.some(A=>A.role==="assistant"&&A.content===s)||e(6,c=[...c,{role:"assistant",content:s}])),e(6,c=[...c,{role:"user",content:_}]),e(3,s=""),e(7,g=!0),setTimeout(()=>{const f=document.getElementById("open-webui-followup-input");f&&f.focus()},100);let x=k,h=m,E=v;try{const f=await chrome.storage.local.get(["url","key","model"]);if(f.url&&(x=f.url),f.model&&(E=f.model),f.key)try{const A=await chrome.runtime.sendMessage({action:"decryptApiKey",encryptedApiKey:f.key});A.error?(console.error("Extension: Failed to decrypt API key:",A.error),h=f.key):h=A.decrypted}catch(A){console.error("Extension: Error decrypting API key:",A),h=f.key}}catch(f){f.message&&f.message.includes("Extension context invalidated")||console.log("Failed to get stored config:",f)}const j=(S.length>0?((I=S.find(f=>f.id===E))==null?void 0:I.owned_by)==="openai":!1)?`${x}/openai`:`${x}/ollama/v1`;try{const[f,A]=await Se(h,{model:E,messages:c,stream:!0},j);if(f&&f.ok){const M=f.body.pipeThrough(new TextDecoderStream).pipeThrough(Pe(`
`)).getReader();for(;;){const{value:L,done:O}=await M.read();if(O)break;try{let z=L.split(`
`);for(const X of z)if(X!==""&&X!=="data: [DONE]"){let te=JSON.parse(X.replace(/^data: /,""));if(!("request_id"in te)){const G=te.choices[0].delta.content??"";e(3,s+=G),C&&setTimeout(()=>{e(14,C.scrollTop=C.scrollHeight,C)},0)}}}catch(z){console.log(z)}}try{s&&(c.some(O=>O.role==="assistant"&&O.content===s)||e(6,c=[...c,{role:"assistant",content:s}])),e(7,g=!1),e(3,s=""),setTimeout(()=>{const L=document.getElementById("open-webui-followup-input");L&&L.focus()},100)}catch(L){console.error("Extension: Error adding response to history:",L),e(7,g=!1)}}else console.error("Extension: API request failed:",f),e(7,g=!1)}catch(f){console.error("Extension: Error sending follow-up:",f);const A=(f==null?void 0:f.message)||String(f);if(A.includes("Rate limit exceeded")&&(e(8,b=A),e(9,p=!0),setTimeout(()=>{e(9,p=!1),e(8,b="")},5e3)),s&&g)try{c.some(L=>L.role==="assistant"&&L.content===s)||e(6,c=[...c,{role:"assistant",content:s}])}catch(M){console.error("Extension: Could not save response:",M)}e(7,g=!1)}};ft(async()=>{window.openWebUIToggleSearch=V;const _=()=>{V()};window.addEventListener("open-webui-toggle-search",_);const x=a=>{a.detail&&a.detail.content&&de(a.detail.content)};window.addEventListener("open-webui-summarize-page",x),chrome.runtime.onMessage.addListener((a,j,I)=>(console.log("Content script received message:",a),a.action==="toggleSearch"?(console.log("Toggling search interface"),V(),I({success:!0})):a.action==="summarizePage"&&(a.error?(console.error("Extension: Error from background script:",a.error),e(8,b=a.error),e(9,p=!0),e(2,r=!0),setTimeout(()=>{e(9,p=!1),e(8,b="")},5e3)):a.content&&de(a.content),I({success:!0})),!0));const h=async a=>{var j;if(l&&a.shiftKey&&a.key==="Escape"?P():a.key==="Escape"&&(r?(e(2,r=!1),e(3,s=""),e(4,u=""),e(5,w=""),e(6,c=[]),e(7,g=!1)):e(0,l=!1)),a.key==="Enter"&&(a.metaKey||a.ctrlKey)&&(a.shiftKey||a.altKey)){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();let I=k,f=m,A=v;try{const M=await chrome.storage.local.get(["url","key","model"]);if(M.url&&(I=M.url,e(10,k=M.url)),M.model&&(A=M.model,e(15,v=M.model)),M.key)try{const L=await chrome.runtime.sendMessage({action:"decryptApiKey",encryptedApiKey:M.key});L.error?(console.error("Extension: Failed to decrypt API key:",L.error),f=M.key,e(11,m=M.key)):(f=L.decrypted,e(11,m=L.decrypted))}catch(L){console.error("Extension: Error decrypting API key:",L),f=M.key,e(11,m=M.key)}}catch(M){M.message&&M.message.includes("Extension context invalidated")||console.log("Failed to get stored config:",M)}if(!I||!f||!A){console.warn("Extension: Missing configuration. Please configure the extension first.");return}try{const M=await chrome.runtime.sendMessage({action:"getSelection"});if((M==null?void 0:M.data)??!1){e(4,u=M.data),e(3,s=""),e(6,c=[{role:"system",content:"You are a helpful assistant."},{role:"user",content:M.data}]),e(2,r=!0),e(7,g=!0);const L=document.activeElement;let O=null;L&&(L.tagName==="INPUT"||L.tagName==="TEXTAREA")&&(O=L);let z=null;O&&(z=O.id||`open-webui-target-${Date.now()}`,O.id||(O.id=z));const te=(S.length>0?((j=S.find(Me=>Me.id===A))==null?void 0:j.owned_by)==="openai":!1)?`${I}/openai`:`${I}/ollama/v1`,[G,Ut]=await Se(f,{model:A,messages:c,stream:!0},te);if(G&&G.ok){const Me=G.body.pipeThrough(new TextDecoderStream).pipeThrough(Pe(`
`)).getReader();let lt=!1;for(;;){const{value:oe,done:he}=await Me.read();if(he)break;try{let Ce=oe.split(`
`);for(const ye of Ce)if(ye!=="")if(console.log(ye),ye==="data: [DONE]")console.log("DONE"),lt=!0;else{let be=JSON.parse(ye.replace(/^data: /,""));if(console.log(be),"request_id"in be)console.log(be.request_id);else{const Le=be.choices[0].delta.content??"";e(3,s+=Le),C&&setTimeout(()=>{e(14,C.scrollTop=C.scrollHeight,C)},0),z&&Le&&await chrome.runtime.sendMessage({action:"writeText",text:Le,targetId:z})}}}catch(Ce){console.log(Ce)}}try{s&&(c.some(he=>he.role==="assistant"&&he.content===s)||e(6,c=[...c,{role:"assistant",content:s}])),e(7,g=!1),e(3,s=""),setTimeout(()=>{const oe=document.getElementById("open-webui-followup-input");oe&&oe.focus()},100)}catch(oe){console.error("Extension: Error adding response to history:",oe),e(7,g=!1)}}else console.error("Extension: API request failed:",G),e(2,r=!1),e(7,g=!1)}}catch(M){console.error("Extension: Error getting AI response:",M);const L=(M==null?void 0:M.message)||String(M);if(L.includes("Rate limit exceeded")&&(e(8,b=L),e(9,p=!0),e(2,r=!0),setTimeout(()=>{e(9,p=!1),e(8,b="")},5e3)),s&&g)try{c.some(z=>z.role==="assistant"&&z.content===s)||e(6,c=[...c,{role:"assistant",content:s}])}catch(O){console.error("Extension: Could not save response:",O)}e(7,g=!1)}}};document.addEventListener("keydown",h,{capture:!0,passive:!1});let E=null;try{E=await chrome.storage.local.get()}catch(a){console.log(a)}if(E){if(e(10,k=E.url??""),e(15,v=E.model??""),E.key)try{const a=await chrome.runtime.sendMessage({action:"decryptApiKey",encryptedApiKey:E.key});a.error?(console.error("Extension: Failed to decrypt API key:",a.error),e(11,m=E.key)):e(11,m=a.decrypted)}catch(a){console.error("Extension: Error decrypting API key:",a),e(11,m=E.key)}else e(11,m="");if(E.url&&m&&E.model){e(1,n=!1);try{e(13,S=await Ne(m,E.url))}catch(a){const j=(a==null?void 0:a.message)||String(a);!j.includes("CORS")&&!j.includes("Failed to fetch")&&!j.includes("Rate limit exceeded")&&console.log("Failed to load models (non-critical):",a)}}else e(1,n=!0)}else e(1,n=!0);return()=>{document.removeEventListener("keydown",h),window.removeEventListener("open-webui-toggle-search",_),window.removeEventListener("open-webui-summarize-page",x),delete window.openWebUIToggleSearch}});function D(){k=this.value,e(10,k)}function $(){m=this.value,e(11,m)}const pe=async()=>{k.endsWith("/")&&e(10,k=k.slice(0,-1));try{e(13,S=await Ne(m,k)),e(9,p=!1),e(8,b="")}catch(_){const x=(_==null?void 0:_.message)||String(_);x.includes("Rate limit exceeded")?(e(8,b=x),e(9,p=!0),setTimeout(()=>{e(9,p=!1),e(8,b="")},5e3)):console.error("Extension: Error fetching models:",_)}};function re(){v=ut(this),e(15,v),e(13,S)}function me(){R=this.value,e(12,R)}const J=()=>{e(1,n=!0)},ue=()=>{e(0,l=!1)},ge=()=>{e(2,r=!1),e(3,s=""),e(4,u=""),e(5,w=""),e(6,c=[]),e(7,g=!1)};function Q(_){Oe[_?"unshift":"push"](()=>{C=_,e(14,C)})}function U(){w=this.value,e(5,w)}return[l,n,r,s,u,w,c,g,b,p,k,m,R,S,C,v,q,Z,Y,B,D,$,pe,re,me,J,ue,ge,Q,U,()=>{const _=c.filter(x=>x.role!=="system").map(x=>`${x.role==="user"?"You":"Assistant"}: ${x.content}`).join(`

`);navigator.clipboard.writeText(_)},()=>{e(2,r=!1),e(3,s=""),e(4,u=""),e(5,w=""),e(6,c=[]),e(7,g=!1)}]}class Ot extends nt{constructor(o){super(),ot(this,o,Pt,Lt,Je,{},null,[-1,-1])}}function Ht(t){let o,e,l;return e=new Ot({}),{c(){o=y("div"),bt(e.$$.fragment),i(o,"class","extension-container")},m(n,r){K(n,o,r),et(e,o,null),l=!0},p:ne,i(n){l||($e(e.$$.fragment,n),l=!0)},o(n){yt(e.$$.fragment,n),l=!1},d(n){n&&N(o),tt(e)}}}class Rt extends nt{constructor(o){super(),ot(this,o,null,Ht,Je,{})}}function ve(){const t=document.getElementById("extension-app");return t?new Rt({target:t}):(console.warn("Extension app target element not found, retrying..."),setTimeout(ve,100),null)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ve):ve();ve();
