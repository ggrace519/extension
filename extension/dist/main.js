var nt=Object.defineProperty;var ot=(t,l,e)=>l in t?nt(t,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[l]=e;var Ie=(t,l,e)=>ot(t,typeof l!="symbol"?l+"":l,e);(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();function te(){}function We(t){return t()}function Te(){return Object.create(null)}function le(t){t.forEach(We)}function Ze(t){return typeof t=="function"}function Ve(t,l){return t!=t?l==l:t!==l||t&&typeof t=="object"||typeof t=="function"}function rt(t){return Object.keys(t).length===0}function u(t,l){t.appendChild(l)}function B(t,l,e){t.insertBefore(l,e||null)}function U(t){t.parentNode&&t.parentNode.removeChild(t)}function Ye(t,l){for(let e=0;e<t.length;e+=1)t[e]&&t[e].d(l)}function w(t){return document.createElement(t)}function Se(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function G(t){return document.createTextNode(t)}function M(){return G(" ")}function Je(){return G("")}function j(t,l,e,o){return t.addEventListener(l,e,o),()=>t.removeEventListener(l,e,o)}function st(t){return function(l){return l.preventDefault(),t.call(this,l)}}function i(t,l,e){e==null?t.removeAttribute(l):t.getAttribute(l)!==e&&t.setAttribute(l,e)}function dt(t){return Array.from(t.childNodes)}function ue(t,l){l=""+l,t.data!==l&&(t.data=l)}function z(t,l){t.value=l??""}function He(t,l,e){for(let o=0;o<t.options.length;o+=1){const n=t.options[o];if(n.__value===l){n.selected=!0;return}}(!e||l!==void 0)&&(t.selectedIndex=-1)}function it(t){const l=t.querySelector(":checked");return l&&l.__value}let ce;function ie(t){ce=t}function ct(){if(!ce)throw new Error("Function called outside component initialization");return ce}function ut(t){ct().$$.on_mount.push(t)}const oe=[],Le=[];let re=[];const Pe=[],at=Promise.resolve();let Ce=!1;function ft(){Ce||(Ce=!0,at.then(Qe))}function _e(t){re.push(t)}const Me=new Set;let ne=0;function Qe(){if(ne!==0)return;const t=ce;do{try{for(;ne<oe.length;){const l=oe[ne];ne++,ie(l),wt(l.$$)}}catch(l){throw oe.length=0,ne=0,l}for(ie(null),oe.length=0,ne=0;Le.length;)Le.pop()();for(let l=0;l<re.length;l+=1){const e=re[l];Me.has(e)||(Me.add(e),e())}re.length=0}while(oe.length);for(;Pe.length;)Pe.pop()();Ce=!1,Me.clear(),ie(t)}function wt(t){if(t.fragment!==null){t.update(),le(t.before_update);const l=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,l),t.after_update.forEach(_e)}}function pt(t){const l=[],e=[];re.forEach(o=>t.indexOf(o)===-1?l.push(o):e.push(o)),e.forEach(o=>o()),re=l}const ye=new Set;let mt;function Xe(t,l){t&&t.i&&(ye.delete(t),t.i(l))}function ht(t,l,e,o){if(t&&t.o){if(ye.has(t))return;ye.add(t),mt.c.push(()=>{ye.delete(t)}),t.o(l)}}function be(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function gt(t){t&&t.c()}function Ge(t,l,e){const{fragment:o,after_update:n}=t.$$;o&&o.m(l,e),_e(()=>{const r=t.$$.on_mount.map(We).filter(Ze);t.$$.on_destroy?t.$$.on_destroy.push(...r):le(r),t.$$.on_mount=[]}),n.forEach(_e)}function $e(t,l){const e=t.$$;e.fragment!==null&&(pt(e.after_update),le(e.on_destroy),e.fragment&&e.fragment.d(l),e.on_destroy=e.fragment=null,e.ctx=[])}function yt(t,l){t.$$.dirty[0]===-1&&(oe.push(t),ft(),t.$$.dirty.fill(0)),t.$$.dirty[l/31|0]|=1<<l%31}function et(t,l,e,o,n,r,s=null,c=[-1]){const a=ce;ie(t);const d=t.$$={fragment:null,ctx:[],props:r,update:te,not_equal:n,bound:Te(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(a?a.$$.context:[])),callbacks:Te(),dirty:c,skip_bound:!1,root:l.target||a.$$.root};s&&s(d.root);let p=!1;if(d.ctx=e?e(t,l.props||{},(g,m,...h)=>{const f=h.length?h[0]:m;return d.ctx&&n(d.ctx[g],d.ctx[g]=f)&&(!d.skip_bound&&d.bound[g]&&d.bound[g](f),p&&yt(t,g)),m}):[],d.update(),p=!0,le(d.before_update),d.fragment=o?o(d.ctx):!1,l.target){if(l.hydrate){const g=dt(l.target);d.fragment&&d.fragment.l(g),g.forEach(U)}else d.fragment&&d.fragment.c();l.intro&&Xe(t.$$.fragment),Ge(t,l.target,l.anchor),Qe()}ie(a)}class tt{constructor(){Ie(this,"$$");Ie(this,"$$set")}$destroy(){$e(this,1),this.$destroy=te}$on(l,e){if(!Ze(e))return te;const o=this.$$.callbacks[l]||(this.$$.callbacks[l]=[]);return o.push(e),()=>{const n=o.indexOf(e);n!==-1&&o.splice(n,1)}}$set(l){this.$$set&&!rt(l)&&(this.$$.skip_bound=!0,this.$$set(l),this.$$.skip_bound=!1)}}const _t="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(_t);const Oe=async(t,l)=>new Promise((e,o)=>{chrome.runtime.sendMessage({action:"fetchModels",url:l,key:t},n=>{var s;if(chrome.runtime.lastError){o(new Error(chrome.runtime.lastError.message));return}if(n.error){o(n.error);return}let r=((s=n.data)==null?void 0:s.data)??[];r=r.filter(c=>c).sort((c,a)=>{const d=c.name.toLowerCase(),p=a.name.toLowerCase();return d<p?-1:d>p?1:c<a?-1:c>a?1:0}),console.log(r),e(r)})}),je=async(t="",l={},e="http://localhost:8080")=>new Promise((o,n)=>{const r=chrome.runtime.connect({name:"chat-stream"});let s=null,c=!1;const a=new ReadableStream({start(p){s=p}});r.onMessage.addListener(p=>{if(p.error){s&&s.error(new Error(p.error)),r.disconnect(),n(new Error(p.error));return}if(p.done){c=!0,s&&s.close(),r.disconnect();return}p.chunk&&s&&s.enqueue(new TextEncoder().encode(p.chunk))}),r.onDisconnect.addListener(()=>{!c&&s&&s.error(new Error("Stream disconnected unexpectedly"))});const d={ok:!0,status:200,body:a};r.postMessage({action:"fetchChatCompletion",url:e,api_key:t,body:l}),o([d,{abort:()=>{r.disconnect()}}])}),Re=t=>{let l="";return new TransformStream({transform(e,o){l+=e;const n=l.split(t);n.slice(0,-1).forEach(r=>o.enqueue(r)),l=n[n.length-1]},flush(e){l&&e.enqueue(l)}})};function Ne(t,l,e){const o=t.slice();return o[33]=l[e],o[35]=e,o}function Ue(t,l,e){const o=t.slice();return o[15]=l[e],o}function Be(t){let l,e,o;function n(c,a){return c[1]?xt:bt}let r=n(t),s=r(t);return{c(){l=w("div"),s.c(),i(l,"class","tlwd-fixed tlwd-top-0 tlwd-right-0 tlwd-left-0 tlwd-bottom-0 tlwd-w-full tlwd-min-h-screen tlwd-h-screen tlwd-flex tlwd-justify-center tlwd-z-[9999999999] tlwd-overflow-hidden tlwd-overscroll-contain")},m(c,a){B(c,l,a),s.m(l,null),e||(o=j(l,"mousedown",t[25]),e=!0)},p(c,a){r===(r=n(c))&&s?s.p(c,a):(s.d(1),s=r(c),s&&(s.c(),s.m(l,null)))},d(c){c&&U(l),s.d(),e=!1,o()}}}function bt(t){let l,e,o,n,r,s,c,a,d,p,g,m,h,f;return{c(){l=w("div"),e=w("div"),o=w("form"),n=w("div"),r=w("div"),r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path></svg>`,s=M(),c=w("input"),a=M(),d=w("div"),p=w("div"),p.textContent="Press âŒ˜Space+Shift to toggle",g=M(),m=w("button"),m.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-3"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path></svg>`,i(r,"class","tlwd-flex tlwd-items-center"),i(c,"id","open-webui-search-input"),i(c,"placeholder","Search Open WebUI"),i(c,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),i(c,"autocomplete","one-time-code"),i(n,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full"),i(p,"class","tlwd-text-right tlwd-text-[0.7rem] tlwd-p-0 tlwd-m-0 tlwd-text-neutral-300 tlwd-h-fit"),i(m,"class","tlwd-h-fit tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),i(m,"type","button"),i(d,"class","tlwd-flex tlwd-justify-end tlwd-gap-1 tlwd-items-center"),i(o,"class","tlwd-text-gray-200 tlwd-w-full tlwd-p-0 tlwd-m-0"),i(o,"autocomplete","off"),i(e,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-2.5 tlwd-px-3.5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation"),i(l,"class","tlwd-m-auto tlwd-max-w-xl tlwd-w-full tlwd-pb-32")},m(y,P){B(y,l,P),u(l,e),u(e,o),u(o,n),u(n,r),u(n,s),u(n,c),z(c,t[12]),u(o,a),u(o,d),u(d,p),u(d,g),u(d,m),h||(f=[j(c,"input",t[23]),j(m,"click",t[24]),j(o,"submit",t[16]),j(o,"mousedown",Ct)],h=!0)},p(y,P){P[0]&4096&&c.value!==y[12]&&z(c,y[12])},d(y){y&&U(l),h=!1,le(f)}}}function xt(t){let l,e,o,n,r,s,c,a,d,p,g,m,h,f,y,P,L,E=t[13]&&t[13].length>0&&Ke(t);return{c(){l=w("div"),e=w("div"),o=w("form"),n=w("div"),r=w("div"),r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"></path></svg>`,s=M(),c=w("input"),a=M(),d=w("div"),p=w("div"),p.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"></path></svg>`,g=M(),m=w("input"),h=M(),f=w("button"),f.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"></path></svg>`,y=M(),E&&E.c(),i(r,"class","tlwd-flex tlwd-items-center"),i(c,"id","open-webui-url-input"),i(c,"placeholder","Open WebUI URL"),i(c,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),i(c,"autocomplete","one-time-code"),c.required=!0,i(n,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full"),i(p,"class","tlwd-flex tlwd-items-center"),i(m,"placeholder","Open WebUI API Key"),i(m,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),i(m,"autocomplete","one-time-code"),m.required=!0,i(f,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),i(f,"type","button"),i(d,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mt-2"),i(o,"class","tlwd-text-gray-200 tlwd-w-full tlwd-p-0 tlwd-m-0"),i(o,"autocomplete","off"),i(e,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-2.5 tlwd-px-3.5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation"),i(l,"class","tlwd-m-auto tlwd-max-w-sm tlwd-w-full tlwd-pb-32")},m(C,D){B(C,l,D),u(l,e),u(e,o),u(o,n),u(n,r),u(n,s),u(n,c),z(c,t[10]),u(o,a),u(o,d),u(d,p),u(d,g),u(d,m),z(m,t[11]),u(d,h),u(d,f),u(o,y),E&&E.m(o,null),P||(L=[j(c,"input",t[19]),j(m,"input",t[20]),j(f,"click",t[21]),j(o,"submit",t[17]),j(o,"mousedown",Lt)],P=!0)},p(C,D){D[0]&1024&&c.value!==C[10]&&z(c,C[10]),D[0]&2048&&m.value!==C[11]&&z(m,C[11]),C[13]&&C[13].length>0?E?E.p(C,D):(E=Ke(C),E.c(),E.m(o,null)):E&&(E.d(1),E=null)},d(C){C&&U(l),E&&E.d(),P=!1,le(L)}}}function Ke(t){let l,e,o,n,r,s,c,a,d,p=be(t[13]),g=[];for(let m=0;m<p.length;m+=1)g[m]=qe(Ue(t,p,m));return{c(){l=w("div"),e=w("div"),e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"></path></svg>`,o=M(),n=w("select"),r=w("option"),r.textContent="Select a model";for(let m=0;m<g.length;m+=1)g[m].c();s=M(),c=w("button"),c.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path></svg>`,i(e,"class","tlwd-flex tlwd-items-center"),r.__value="",z(r,r.__value),i(n,"id","open-webui-model-input"),i(n,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),i(n,"autocomplete","off"),n.required=!0,t[15]===void 0&&_e(()=>t[22].call(n)),i(c,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),i(c,"type","submit"),i(l,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mt-2")},m(m,h){B(m,l,h),u(l,e),u(l,o),u(l,n),u(n,r);for(let f=0;f<g.length;f+=1)g[f]&&g[f].m(n,null);He(n,t[15],!0),u(l,s),u(l,c),a||(d=j(n,"change",t[22]),a=!0)},p(m,h){if(h[0]&8192){p=be(m[13]);let f;for(f=0;f<p.length;f+=1){const y=Ue(m,p,f);g[f]?g[f].p(y,h):(g[f]=qe(y),g[f].c(),g[f].m(n,null))}for(;f<g.length;f+=1)g[f].d(1);g.length=p.length}h[0]&40960&&He(n,m[15])},d(m){m&&U(l),Ye(g,m),a=!1,d()}}}function qe(t){let l,e=(t[15].name??t[15].id)+"",o,n;return{c(){l=w("option"),o=G(e),l.__value=n=t[15].id,z(l,l.__value)},m(r,s){B(r,l,s),u(l,o)},p(r,s){s[0]&8192&&e!==(e=(r[15].name??r[15].id)+"")&&ue(o,e),s[0]&8192&&n!==(n=r[15].id)&&(l.__value=n,z(l,l.__value))},d(r){r&&U(l)}}}function ze(t){let l,e,o,n,r,s,c,a,d,p,g,m,h,f,y,P,L,E,C,D,F,W,ae,Z,se,fe,V=be(t[6]),O=[];for(let b=0;b<V.length;b+=1)O[b]=De(Ne(t,V,b));function we(b,q){if(b[3]&&b[7])return It;if(b[7]&&!b[3])return Et}let Y=we(t),R=Y&&Y(t),N=t[9]&&t[8]&&Fe(t);return{c(){l=w("div"),e=w("div"),o=w("div"),n=w("div"),r=w("div"),r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5 tlwd-text-neutral-300"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"></path></svg> <h3 class="tlwd-text-lg tlwd-font-semibold tlwd-text-neutral-100">AI Response</h3>`,s=M(),c=w("button"),c.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>`,a=M(),d=w("div");for(let b=0;b<O.length;b+=1)O[b].c();p=M(),R&&R.c(),g=M(),N&&N.c(),m=M(),h=w("div"),f=w("form"),y=w("input"),P=M(),L=w("button"),E=G("Send"),D=M(),F=w("div"),W=w("div"),W.textContent="Press Escape to close",ae=M(),Z=w("button"),Z.textContent="Copy conversation",i(r,"class","tlwd-flex tlwd-items-center tlwd-gap-2"),i(c,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-400 hover:tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-1 tlwd-outline-none tlwd-border-none tlwd-transition-colors"),i(c,"type","button"),i(n,"class","tlwd-flex tlwd-items-center tlwd-justify-between tlwd-mb-4 tlwd-pb-3 tlwd-border-b tlwd-border-gray-700"),i(d,"class","tlwd-flex-1 tlwd-overflow-y-auto tlwd-pr-2 tlwd-mb-4"),i(y,"id","open-webui-followup-input"),i(y,"type","text"),i(y,"placeholder","Ask a follow-up question..."),y.disabled=t[7],i(y,"class","tlwd-flex-1 tlwd-px-3 tlwd-py-2 tlwd-text-sm tlwd-bg-gray-800/50 tlwd-border tlwd-border-gray-700 tlwd-rounded-lg tlwd-text-neutral-100 placeholder:tlwd-text-neutral-500 tlwd-outline-none focus:tlwd-border-gray-600 disabled:tlwd-opacity-50 disabled:tlwd-cursor-not-allowed"),i(y,"autocomplete","off"),i(L,"type","submit"),L.disabled=C=!t[5].trim()||t[7],i(L,"class","tlwd-px-4 tlwd-py-2 tlwd-text-sm tlwd-font-medium tlwd-bg-blue-600 hover:tlwd-bg-blue-700 disabled:tlwd-opacity-50 disabled:tlwd-cursor-not-allowed tlwd-text-white tlwd-rounded-lg tlwd-transition-colors tlwd-outline-none tlwd-border-none"),i(f,"class","tlwd-flex tlwd-items-center tlwd-gap-2"),i(W,"class","tlwd-text-xs tlwd-text-neutral-400"),i(Z,"class","tlwd-text-xs tlwd-text-neutral-300 hover:tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-outline-none tlwd-border-none tlwd-bg-transparent tlwd-transition-colors"),i(Z,"type","button"),i(F,"class","tlwd-mt-3 tlwd-flex tlwd-items-center tlwd-justify-between"),i(h,"class","tlwd-border-t tlwd-border-gray-700 tlwd-pt-3"),i(o,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-4 tlwd-px-5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation tlwd-max-h-[80vh] tlwd-overflow-hidden tlwd-flex tlwd-flex-col"),i(e,"class","tlwd-m-auto tlwd-max-w-3xl tlwd-w-full tlwd-pb-32 tlwd-px-4"),i(l,"class","tlwd-fixed tlwd-top-0 tlwd-right-0 tlwd-left-0 tlwd-bottom-0 tlwd-w-full tlwd-min-h-screen tlwd-h-screen tlwd-flex tlwd-justify-center tlwd-z-[9999999999] tlwd-overflow-hidden tlwd-overscroll-contain")},m(b,q){B(b,l,q),u(l,e),u(e,o),u(o,n),u(n,r),u(n,s),u(n,c),u(o,a),u(o,d);for(let S=0;S<O.length;S+=1)O[S]&&O[S].m(d,null);u(d,p),R&&R.m(d,null),t[27](d),u(o,g),N&&N.m(o,null),u(o,m),u(o,h),u(h,f),u(f,y),z(y,t[5]),u(f,P),u(f,L),u(L,E),u(h,D),u(h,F),u(F,W),u(F,ae),u(F,Z),se||(fe=[j(c,"click",t[26]),j(y,"input",t[28]),j(f,"submit",st(t[18])),j(Z,"click",t[29]),j(o,"mousedown",At),j(l,"mousedown",t[30])],se=!0)},p(b,q){if(q[0]&64){V=be(b[6]);let S;for(S=0;S<V.length;S+=1){const x=Ne(b,V,S);O[S]?O[S].p(x,q):(O[S]=De(x),O[S].c(),O[S].m(d,p))}for(;S<O.length;S+=1)O[S].d(1);O.length=V.length}Y===(Y=we(b))&&R?R.p(b,q):(R&&R.d(1),R=Y&&Y(b),R&&(R.c(),R.m(d,null))),b[9]&&b[8]?N?N.p(b,q):(N=Fe(b),N.c(),N.m(o,m)):N&&(N.d(1),N=null),q[0]&128&&(y.disabled=b[7]),q[0]&32&&y.value!==b[5]&&z(y,b[5]),q[0]&160&&C!==(C=!b[5].trim()||b[7])&&(L.disabled=C)},d(b){b&&U(l),Ye(O,b),R&&R.d(),t[27](null),N&&N.d(),se=!1,le(fe)}}}function kt(t){let l,e,o,n,r=t[33].content+"",s,c;return{c(){l=w("div"),e=w("div"),e.textContent="Assistant:",o=M(),n=w("div"),s=G(r),c=M(),i(e,"class","tlwd-text-xs tlwd-text-neutral-400 tlwd-mb-1"),i(n,"class","tlwd-text-sm tlwd-text-neutral-100 tlwd-whitespace-pre-wrap tlwd-leading-relaxed"),i(l,"class","tlwd-mb-4")},m(a,d){B(a,l,d),u(l,e),u(l,o),u(l,n),u(n,s),u(l,c)},p(a,d){d[0]&64&&r!==(r=a[33].content+"")&&ue(s,r)},d(a){a&&U(l)}}}function vt(t){let l,e,o,n,r=t[33].content+"",s,c;return{c(){l=w("div"),e=w("div"),e.textContent="You:",o=M(),n=w("div"),s=G(r),c=M(),i(e,"class","tlwd-text-xs tlwd-text-neutral-400 tlwd-mb-1"),i(n,"class","tlwd-text-sm tlwd-text-neutral-200 tlwd-bg-gray-800/50 tlwd-rounded-lg tlwd-p-3"),i(l,"class","tlwd-mb-4")},m(a,d){B(a,l,d),u(l,e),u(l,o),u(l,n),u(n,s),u(l,c)},p(a,d){d[0]&64&&r!==(r=a[33].content+"")&&ue(s,r)},d(a){a&&U(l)}}}function De(t){let l;function e(r,s){if(r[33].role==="user")return vt;if(r[33].role==="assistant")return kt}let o=e(t),n=o&&o(t);return{c(){n&&n.c(),l=Je()},m(r,s){n&&n.m(r,s),B(r,l,s)},p(r,s){o===(o=e(r))&&n?n.p(r,s):(n&&n.d(1),n=o&&o(r),n&&(n.c(),n.m(l.parentNode,l)))},d(r){r&&U(l),n&&n.d(r)}}}function Et(t){let l;return{c(){l=w("div"),l.innerHTML='<div class="tlwd-text-xs tlwd-text-neutral-400 tlwd-mb-1">Assistant:</div> <span class="tlwd-text-neutral-400 tlwd-italic">Waiting for response...</span>',i(l,"class","tlwd-mb-4")},m(e,o){B(e,l,o)},p:te,d(e){e&&U(l)}}}function It(t){let l,e,o,n,r,s,c;return{c(){l=w("div"),e=w("div"),e.textContent="Assistant:",o=M(),n=w("div"),r=G(t[3]),s=M(),c=w("span"),c.textContent="|",i(e,"class","tlwd-text-xs tlwd-text-neutral-400 tlwd-mb-1"),i(c,"class","tlwd-inline-block tlwd-w-2 tlwd-h-4 tlwd-bg-neutral-400 tlwd-ml-1 tlwd-animate-pulse"),i(n,"class","tlwd-text-sm tlwd-text-neutral-100 tlwd-whitespace-pre-wrap tlwd-leading-relaxed"),i(l,"class","tlwd-mb-4")},m(a,d){B(a,l,d),u(l,e),u(l,o),u(l,n),u(n,r),u(n,s),u(n,c)},p(a,d){d[0]&8&&ue(r,a[3])},d(a){a&&U(l)}}}function Fe(t){let l,e,o,n,r,s,c;return{c(){l=w("div"),e=w("div"),o=Se("svg"),n=Se("path"),r=M(),s=w("p"),c=G(t[8]),i(n,"stroke-linecap","round"),i(n,"stroke-linejoin","round"),i(n,"d","M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"),i(o,"xmlns","http://www.w3.org/2000/svg"),i(o,"fill","none"),i(o,"viewBox","0 0 24 24"),i(o,"stroke-width",2.5),i(o,"stroke","currentColor"),i(o,"class","tlwd-size-5 tlwd-text-red-400"),i(s,"class","tlwd-text-sm tlwd-text-red-300"),i(e,"class","tlwd-flex tlwd-items-center tlwd-gap-2"),i(l,"class","tlwd-mb-3 tlwd-p-3 tlwd-bg-red-900/20 tlwd-border tlwd-border-red-700/50 tlwd-rounded-lg")},m(a,d){B(a,l,d),u(l,e),u(e,o),u(o,n),u(e,r),u(e,s),u(s,c)},p(a,d){d[0]&256&&ue(c,a[8])},d(a){a&&U(l)}}}function Mt(t){let l,e,o=t[0]&&Be(t),n=t[2]&&ze(t);return{c(){o&&o.c(),l=M(),n&&n.c(),e=Je()},m(r,s){o&&o.m(r,s),B(r,l,s),n&&n.m(r,s),B(r,e,s)},p(r,s){r[0]?o?o.p(r,s):(o=Be(r),o.c(),o.m(l.parentNode,l)):o&&(o.d(1),o=null),r[2]?n?n.p(r,s):(n=ze(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:te,o:te,d(r){r&&(U(l),U(e)),o&&o.d(r),n&&n.d(r)}}}const Lt=t=>{t.stopPropagation()},Ct=t=>{t.stopPropagation()},At=t=>{t.stopPropagation()};function Tt(t,l,e){let o=!1,n=!0,r=!1,s="",c="",a="",d=[],p=!1,g="",m=!1,h="",f="",y="",P="",L=[],E=null;const C=()=>{console.log("resetConfig");try{chrome.storage.local.clear().then(()=>{console.log("Value is cleared")})}catch(x){console.log(x)}e(10,h=""),e(11,f=""),e(15,y=""),e(13,L=[]),e(1,n=!0)},D=x=>{x.preventDefault();try{const I=new URL(h.startsWith("http")?h:`https://${h}`);if(!["http:","https:"].includes(I.protocol)){console.error("Extension: Invalid URL protocol");return}const H=encodeURIComponent(P),k=encodeURIComponent(y);window.open(`${h}/?q=${H}&models=${k}`,"_blank"),e(12,P=""),e(0,o=!1)}catch{console.error("Extension: Invalid URL format")}},F=async x=>{x.preventDefault();try{const I=new URL(h.startsWith("http")?h:`https://${h}`);if(!["http:","https:"].includes(I.protocol)){console.error("Extension: Invalid URL protocol");return}}catch{console.error("Extension: Invalid URL format");return}if(!f||typeof f!="string"||f.trim().length===0){console.error("Extension: Invalid API key");return}if(!y||typeof y!="string"||y.trim().length===0){console.error("Extension: Invalid model");return}try{const I=await chrome.runtime.sendMessage({action:"encryptApiKey",apiKey:f.trim()});I.error?(console.error("Extension: Failed to encrypt API key:",I.error),chrome.storage.local.set({url:h.trim(),key:f.trim(),model:y.trim()})):chrome.storage.local.set({url:h.trim(),key:I.encrypted,model:y.trim()}).then(()=>{console.log("Value is set (API key encrypted)")})}catch(I){console.log(I)}e(1,n=!1)},W=async()=>{try{const x=await chrome.runtime.sendMessage({action:"getSelection"});((x==null?void 0:x.data)??!1)&&e(12,P=x.data)}catch(x){console.log("catch",x)}e(0,o=!o),setTimeout(()=>{const x=document.getElementById("open-webui-search-input");x&&x.focus()},0)},ae=async()=>{var X;if(!a.trim()||p)return;const x=a.trim();e(5,a=""),s&&(d.some(_=>_.role==="assistant"&&_.content===s)||e(6,d=[...d,{role:"assistant",content:s}])),e(6,d=[...d,{role:"user",content:x}]),e(3,s=""),e(7,p=!0),setTimeout(()=>{const v=document.getElementById("open-webui-followup-input");v&&v.focus()},100);let I=h,H=f,k=y;try{const v=await chrome.storage.local.get(["url","key","model"]);if(v.url&&(I=v.url),v.model&&(k=v.model),v.key)try{const _=await chrome.runtime.sendMessage({action:"decryptApiKey",encryptedApiKey:v.key});_.error?(console.error("Extension: Failed to decrypt API key:",_.error),H=v.key):H=_.decrypted}catch(_){console.error("Extension: Error decrypting API key:",_),H=v.key}}catch(v){v.message&&v.message.includes("Extension context invalidated")||console.log("Failed to get stored config:",v)}const Q=(L.length>0?((X=L.find(v=>v.id===k))==null?void 0:X.owned_by)==="openai":!1)?`${I}/openai`:`${I}/ollama/v1`;try{const[v,_]=await je(H,{model:k,messages:d,stream:!0},Q);if(v&&v.ok){const A=v.body.pipeThrough(new TextDecoderStream).pipeThrough(Re(`
`)).getReader();for(;;){const{value:T,done:K}=await A.read();if(K)break;try{let pe=T.split(`
`);for(const de of pe)if(de!==""&&de!=="data: [DONE]"){let $=JSON.parse(de.replace(/^data: /,""));if(!("request_id"in $)){const Ae=$.choices[0].delta.content??"";e(3,s+=Ae),E&&setTimeout(()=>{e(14,E.scrollTop=E.scrollHeight,E)},0)}}}catch(pe){console.log(pe)}}try{s&&(d.some(K=>K.role==="assistant"&&K.content===s)||e(6,d=[...d,{role:"assistant",content:s}])),e(7,p=!1),e(3,s=""),setTimeout(()=>{const T=document.getElementById("open-webui-followup-input");T&&T.focus()},100)}catch(T){console.error("Extension: Error adding response to history:",T),e(7,p=!1)}}else console.error("Extension: API request failed:",v),e(7,p=!1)}catch(v){console.error("Extension: Error sending follow-up:",v);const _=(v==null?void 0:v.message)||String(v);if(_.includes("Rate limit exceeded")&&(e(8,g=_),e(9,m=!0),setTimeout(()=>{e(9,m=!1),e(8,g="")},5e3)),s&&p)try{d.some(T=>T.role==="assistant"&&T.content===s)||e(6,d=[...d,{role:"assistant",content:s}])}catch(A){console.error("Extension: Could not save response:",A)}e(7,p=!1)}};ut(async()=>{window.openWebUIToggleSearch=W;const x=()=>{W()};window.addEventListener("open-webui-toggle-search",x),chrome.runtime.onMessage.addListener((k,J,Q)=>(console.log("Content script received message:",k),k.action==="toggleSearch"&&(console.log("Toggling search interface"),W(),Q({success:!0})),!0));const I=async k=>{var J;if(o&&k.shiftKey&&k.key==="Escape"?C():k.key==="Escape"&&(r?(e(2,r=!1),e(3,s=""),e(4,c=""),e(5,a=""),e(6,d=[]),e(7,p=!1)):e(0,o=!1)),k.key==="Enter"&&(k.metaKey||k.ctrlKey)&&(k.shiftKey||k.altKey)){k.preventDefault(),k.stopPropagation(),k.stopImmediatePropagation();let Q=h,X=f,v=y;try{const _=await chrome.storage.local.get(["url","key","model"]);if(_.url&&(Q=_.url,e(10,h=_.url)),_.model&&(v=_.model,e(15,y=_.model)),_.key)try{const A=await chrome.runtime.sendMessage({action:"decryptApiKey",encryptedApiKey:_.key});A.error?(console.error("Extension: Failed to decrypt API key:",A.error),X=_.key,e(11,f=_.key)):(X=A.decrypted,e(11,f=A.decrypted))}catch(A){console.error("Extension: Error decrypting API key:",A),X=_.key,e(11,f=_.key)}}catch(_){_.message&&_.message.includes("Extension context invalidated")||console.log("Failed to get stored config:",_)}if(!Q||!X||!v){console.warn("Extension: Missing configuration. Please configure the extension first.");return}try{const _=await chrome.runtime.sendMessage({action:"getSelection"});if((_==null?void 0:_.data)??!1){e(4,c=_.data),e(3,s=""),e(6,d=[{role:"system",content:"You are a helpful assistant."},{role:"user",content:_.data}]),e(2,r=!0),e(7,p=!0);const A=document.activeElement;let T=null;A&&(A.tagName==="INPUT"||A.tagName==="TEXTAREA")&&(T=A);let K=null;T&&(K=T.id||`open-webui-target-${Date.now()}`,T.id||(T.id=K));const de=(L.length>0?((J=L.find(ke=>ke.id===v))==null?void 0:J.owned_by)==="openai":!1)?`${Q}/openai`:`${Q}/ollama/v1`,[$,Ae]=await je(X,{model:v,messages:d,stream:!0},de);if($&&$.ok){const ke=$.body.pipeThrough(new TextDecoderStream).pipeThrough(Re(`
`)).getReader();let lt=!1;for(;;){const{value:ee,done:me}=await ke.read();if(me)break;try{let ve=ee.split(`
`);for(const he of ve)if(he!=="")if(console.log(he),he==="data: [DONE]")console.log("DONE"),lt=!0;else{let ge=JSON.parse(he.replace(/^data: /,""));if(console.log(ge),"request_id"in ge)console.log(ge.request_id);else{const Ee=ge.choices[0].delta.content??"";e(3,s+=Ee),E&&setTimeout(()=>{e(14,E.scrollTop=E.scrollHeight,E)},0),K&&Ee&&await chrome.runtime.sendMessage({action:"writeText",text:Ee,targetId:K})}}}catch(ve){console.log(ve)}}try{s&&(d.some(me=>me.role==="assistant"&&me.content===s)||e(6,d=[...d,{role:"assistant",content:s}])),e(7,p=!1),e(3,s=""),setTimeout(()=>{const ee=document.getElementById("open-webui-followup-input");ee&&ee.focus()},100)}catch(ee){console.error("Extension: Error adding response to history:",ee),e(7,p=!1)}}else console.error("Extension: API request failed:",$),e(2,r=!1),e(7,p=!1)}}catch(_){console.error("Extension: Error getting AI response:",_);const A=(_==null?void 0:_.message)||String(_);if(A.includes("Rate limit exceeded")&&(e(8,g=A),e(9,m=!0),e(2,r=!0),setTimeout(()=>{e(9,m=!1),e(8,g="")},5e3)),s&&p)try{d.some(K=>K.role==="assistant"&&K.content===s)||e(6,d=[...d,{role:"assistant",content:s}])}catch(T){console.error("Extension: Could not save response:",T)}e(7,p=!1)}}};document.addEventListener("keydown",I,{capture:!0,passive:!1});let H=null;try{H=await chrome.storage.local.get()}catch(k){console.log(k)}if(H){if(e(10,h=H.url??""),e(15,y=H.model??""),H.key)try{const k=await chrome.runtime.sendMessage({action:"decryptApiKey",encryptedApiKey:H.key});k.error?(console.error("Extension: Failed to decrypt API key:",k.error),e(11,f=H.key)):e(11,f=k.decrypted)}catch(k){console.error("Extension: Error decrypting API key:",k),e(11,f=H.key)}else e(11,f="");if(H.url&&f&&H.model){e(1,n=!1);try{e(13,L=await Oe(f,H.url))}catch(k){const J=(k==null?void 0:k.message)||String(k);!J.includes("CORS")&&!J.includes("Failed to fetch")&&!J.includes("Rate limit exceeded")&&console.log("Failed to load models (non-critical):",k)}}else e(1,n=!0)}else e(1,n=!0);return()=>{document.removeEventListener("keydown",I),window.removeEventListener("open-webui-toggle-search",x),delete window.openWebUIToggleSearch}});function Z(){h=this.value,e(10,h)}function se(){f=this.value,e(11,f)}const fe=async()=>{h.endsWith("/")&&e(10,h=h.slice(0,-1));try{e(13,L=await Oe(f,h)),e(9,m=!1),e(8,g="")}catch(x){const I=(x==null?void 0:x.message)||String(x);I.includes("Rate limit exceeded")?(e(8,g=I),e(9,m=!0),setTimeout(()=>{e(9,m=!1),e(8,g="")},5e3)):console.error("Extension: Error fetching models:",x)}};function V(){y=it(this),e(15,y),e(13,L)}function O(){P=this.value,e(12,P)}const we=()=>{e(1,n=!0)},Y=()=>{e(0,o=!1)},R=()=>{e(2,r=!1),e(3,s=""),e(4,c=""),e(5,a=""),e(6,d=[]),e(7,p=!1)};function N(x){Le[x?"unshift":"push"](()=>{E=x,e(14,E)})}function b(){a=this.value,e(5,a)}return[o,n,r,s,c,a,d,p,g,m,h,f,P,L,E,y,D,F,ae,Z,se,fe,V,O,we,Y,R,N,b,()=>{const x=d.filter(I=>I.role!=="system").map(I=>`${I.role==="user"?"You":"Assistant"}: ${I.content}`).join(`

`);navigator.clipboard.writeText(x)},()=>{e(2,r=!1),e(3,s=""),e(4,c=""),e(5,a=""),e(6,d=[]),e(7,p=!1)}]}class St extends tt{constructor(l){super(),et(this,l,Tt,Mt,Ve,{},null,[-1,-1])}}function Ht(t){let l,e,o;return e=new St({}),{c(){l=w("div"),gt(e.$$.fragment),i(l,"class","extension-container")},m(n,r){B(n,l,r),Ge(e,l,null),o=!0},p:te,i(n){o||(Xe(e.$$.fragment,n),o=!0)},o(n){ht(e.$$.fragment,n),o=!1},d(n){n&&U(l),$e(e)}}}class Pt extends tt{constructor(l){super(),et(this,l,null,Ht,Ve,{})}}function xe(){const t=document.getElementById("extension-app");return t?new Pt({target:t}):(console.warn("Extension app target element not found, retrying..."),setTimeout(xe,100),null)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",xe):xe();xe();
